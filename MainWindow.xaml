<Window x:Class="SpreadTrader.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
		xmlns:p="clr-namespace:SpreadTrader.Properties"
        xmlns:local="clr-namespace:SpreadTrader"
        DataContext="{Binding RelativeSource={RelativeSource Self}}"
        Title="SpreadTrader" Height="598" Width="1089" x:Name="UI"  WindowStartupLocation="CenterScreen" Closing="Window_Closing" Loaded="Window_Loaded" >
	
	<Window.Resources>
		<BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
		<Style x:Key="OurButton" TargetType="Button">
			<Setter Property="Background" Value="ivory"/>
			<Setter Property="BorderBrush" Value="DarkGray"/>
			<Setter Property="VerticalContentAlignment" Value="Center"/>
			<Setter Property="Padding" Value="10,0,10,0"/>
			<Setter Property="Button.Effect">
				<Setter.Value>
					<DropShadowEffect Color="Black" Direction="320" ShadowDepth="3" BlurRadius="5" Opacity="0.5" />
				</Setter.Value>
			</Setter>
			<Style.Triggers>
				<MultiTrigger>
					<MultiTrigger.Conditions>
						<Condition Property="IsPressed" Value="False" />
						<Condition Property="IsMouseOver" Value="True" />
					</MultiTrigger.Conditions>
					<Setter Property="Background" Value="Green" />
				</MultiTrigger>
				<Trigger Property="IsPressed" Value="True">
					<Setter Property="Button.Background" Value="Purple" />
					<Setter Property="Button.Effect">
						<Setter.Value>
							<DropShadowEffect Color="Black" Direction="320" ShadowDepth="0" BlurRadius="0" Opacity="0" />
						</Setter.Value>
					</Setter>
				</Trigger>
			</Style.Triggers>
		</Style>
		<Style x:Key="styleOutcome" TargetType="TextBlock">
			<Style.Triggers>
				<DataTrigger Binding="{Binding Path=ProfitIfWin}" Value="True">
					<Setter Property="Foreground" Value="green"/>
				</DataTrigger>
				<DataTrigger Binding="{Binding Path=ProfitIfWin}" Value="False">
					<Setter Property="Foreground" Value="red"/>
				</DataTrigger>
			</Style.Triggers>
		</Style>
		<!--<DataTemplate x:Key="DataTemplate_Sport">
			<Border BorderThickness="0 0 0 0.25" BorderBrush="Black"  HorizontalAlignment="Stretch" >
				<StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch" Margin="1 5 0 2" Tag="{Binding DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListView}}}">
					<TextBlock Text="{Binding details.Venue}" TextAlignment="Left" Margin="5 0 0 0" Width="95"/>
					<TextBlock Text="{Binding marketName}" TextAlignment="Left" Width="Auto"  />
				</StackPanel>
			</Border>
		</DataTemplate>-->
		<DataTemplate x:Key="DataTemplate_Market">
			<Border BorderThickness="0 0 0 0.25" BorderBrush="Black"  HorizontalAlignment="Stretch" >
				<StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch" Margin="1 5 0 2" Tag="{Binding DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListView}}}">
					<Grid Width="25">
						<StackPanel Orientation="Horizontal" >
							<TextBlock Text ="{Binding startTimeGmt, StringFormat='{}{0:HH:mm}'}"  Margin="2 0 0 0" />
						</StackPanel>
					</Grid>
					<TextBlock Text="{Binding details.Venue}" TextAlignment="Left" Margin="5 0 0 0" Width="95"/>
					<TextBlock Text="{Binding marketName}" TextAlignment="Left" Width="Auto"  />
				</StackPanel>
			</Border>
		</DataTemplate>
		<DataTemplate x:Key="DataTemplate_Runner">
			<Border BorderThickness="0 0 0 0.25" BorderBrush="Black">
				<StackPanel Orientation="Horizontal" Tag="{Binding selectionId}">
					<Image Width="32" Source="{Binding Colors}"/>
					<StackPanel Orientation="Vertical">
						<StackPanel Orientation="Horizontal">
							<TextBlock FontSize="11" Background="#FFFFFCFC"  Padding="0,0,0,0" Text="{Binding saddle_number}"  TextAlignment="Left" VerticalAlignment="Top" Width="14" Margin="2" />
							<TextBlock FontSize="11" Background="#FFFFFCFC"  Padding="0,0,0,0" Text="{Binding name}" TextAlignment="Left" VerticalAlignment="Top" Width="130" Margin="2" />
						</StackPanel>
						<TextBlock FontSize="10" Foreground="{Binding OutComeColor}" Background="#FFFFFCFC"  Padding="16,-2,0,0" Text="{Binding ifWin, StringFormat=\{0:C\}}"  TextAlignment="Left" VerticalAlignment="Top" Width="140" Margin="2" />
					</StackPanel>
					<Button Tag="fixed3" VerticalContentAlignment="Center" BorderThickness="0.5" BorderBrush="DarkGray"  Background="#FFC8D0E5" Padding="0,0" Width="40"   >
						<StackPanel Orientation="Vertical">
							<TextBlock FontSize="11" TextAlignment="Center"  Text="{Binding Source={x:Static p:Settings.Default}, Path=back3, Mode=OneWay}"/>
						</StackPanel>
					</Button>
					<Button Tag="fixed2" VerticalContentAlignment="Center" BorderThickness="0.5" BorderBrush="DarkGray"  Background="#FFC8D0E5" Padding="0,0" Width="40"   >
						<StackPanel Orientation="Vertical">
							<TextBlock FontSize="11" TextAlignment="Center"  Text="{Binding Source={x:Static p:Settings.Default}, Path=back2, Mode=OneWay}"/>
						</StackPanel>
					</Button>
					<Button Tag="back3" VerticalContentAlignment="Center" BorderThickness="0.5" BorderBrush="DarkGray"  Background="ivory" Padding="0,0" Width="40"   Visibility="{Binding Source={x:Static p:Settings.Default}, Path=ShowLive, Converter={StaticResource BoolToVisibilityConverter}}">
						<StackPanel Orientation="Vertical">
							<TextBlock FontSize="11" TextAlignment="Center"  Text="{Binding prices[2].price, UpdateSourceTrigger=PropertyChanged}"/>
							<TextBlock FontSize="9"  TextAlignment="Center"  Text="{Binding prices[2].size, StringFormat=\{0:#.#\}, UpdateSourceTrigger=PropertyChanged}"/>
						</StackPanel>
					</Button>
					<Button Tag="back2" VerticalContentAlignment="Center" BorderThickness="0.5" BorderBrush="DarkGray"  Background="ivory" Padding="0,0" Width="40"     Visibility="{Binding Source={x:Static p:Settings.Default}, Path=ShowLive, Converter={StaticResource BoolToVisibilityConverter}}">
						<StackPanel Orientation="Vertical">
							<TextBlock FontSize="11" TextAlignment="Center"  Text="{Binding prices[1].price, UpdateSourceTrigger=PropertyChanged}"/>
							<TextBlock FontSize="9"  TextAlignment="Center"  Text="{Binding prices[1].size, StringFormat=\{0:#.#\}, UpdateSourceTrigger=PropertyChanged}"/>
						</StackPanel>
					</Button>
					<Button Tag="back1" VerticalContentAlignment="Center" BorderThickness="0.5" BorderBrush="DarkGray"  Background="ivory" Padding="0,0" Width="40"     Visibility="{Binding Source={x:Static p:Settings.Default}, Path=ShowLive, Converter={StaticResource BoolToVisibilityConverter}}">
						<StackPanel Orientation="Vertical">
							<TextBlock FontSize="11" TextAlignment="Center"  Text="{Binding prices[0].price, UpdateSourceTrigger=PropertyChanged}"/>
							<TextBlock FontSize="9"  TextAlignment="Center"  Text="{Binding prices[0].size, StringFormat=\{0:#.#\}, UpdateSourceTrigger=PropertyChanged}"/>
						</StackPanel>
					</Button>
					<Button Tag="lay1" VerticalContentAlignment="Center" BorderThickness="0.5" BorderBrush="DarkGray"  Background="ivory" Padding="0,0" Width="40"   Visibility="{Binding Source={x:Static p:Settings.Default}, Path=ShowLive, Converter={StaticResource BoolToVisibilityConverter}}">
						<StackPanel Orientation="Vertical">
							<TextBlock FontSize="11" TextAlignment="Center"  Text="{Binding prices[3].price, UpdateSourceTrigger=PropertyChanged}"/>
							<TextBlock FontSize="9"  TextAlignment="Center"  Text="{Binding prices[3].size, StringFormat=\{0:#.#\}, UpdateSourceTrigger=PropertyChanged}"/>
						</StackPanel>
					</Button>
					<Button Tag="lay2" VerticalContentAlignment="Center" BorderThickness="0.5" BorderBrush="DarkGray"  Background="ivory" Padding="0,0" Width="40"     Visibility="{Binding Source={x:Static p:Settings.Default}, Path=ShowLive, Converter={StaticResource BoolToVisibilityConverter}}">
						<StackPanel Orientation="Vertical">
							<TextBlock FontSize="11" TextAlignment="Center"  Text="{Binding prices[4].price, UpdateSourceTrigger=PropertyChanged}"/>
							<TextBlock FontSize="9"  TextAlignment="Center"  Text="{Binding prices[4].size, StringFormat=\{0:#.#\}, UpdateSourceTrigger=PropertyChanged}"/>
						</StackPanel>
					</Button>
					<Button Tag="lay31" VerticalContentAlignment="Center" BorderThickness="0.5" BorderBrush="DarkGray"  Background="ivory" Padding="0,0" Width="40"     Visibility="{Binding Source={x:Static p:Settings.Default}, Path=ShowLive, Converter={StaticResource BoolToVisibilityConverter}}">
						<StackPanel Orientation="Vertical">
							<TextBlock FontSize="11" TextAlignment="Center"  Text="{Binding prices[5].price, UpdateSourceTrigger=PropertyChanged}"/>
							<TextBlock FontSize="9"  TextAlignment="Center"  Text="{Binding prices[5].size, StringFormat=\{0:#.#\}, UpdateSourceTrigger=PropertyChanged}"/>
						</StackPanel>
					</Button>
					<Button Tag="SP2" VerticalContentAlignment="Center" BorderThickness="0.5" BorderBrush="DarkGray"  Background="{Binding SPColour, Mode=OneWay }" Padding="0,0" Width="40"   >
						<StackPanel Orientation="Vertical">
							<TextBlock FontSize="11" TextAlignment="Center"  Text="{Binding actualSP, StringFormat=\{0:#.#\}, UpdateSourceTrigger=PropertyChanged}"/>
						</StackPanel>
					</Button>
				</StackPanel>
			</Border>
		</DataTemplate>
	</Window.Resources>
	<Grid>
		<DockPanel>
			<ToolBarPanel Orientation="Horizontal" VerticalAlignment="Top" DockPanel.Dock="Top" Height="28">
				<TextBlock Foreground="#FF8D6969" FontWeight="Bold" FontStyle="Italic" FontSize="12" Width="329" Padding="5,6,5,0" Margin="5,0"/>
				<Button  Height="23" Width="125">Exposure
					<Button.ToolTip>
						<ToolTip>
							<TextBlock Text="Sort runners into betting order"></TextBlock>
						</ToolTip>
					</Button.ToolTip>
				</Button>
				<Button Content="{Binding UKBalance}" Height="23" Width="109"  />
				<Label Content="Balance" Height="28" VerticalAlignment="Top"/>
				<TextBlock Height="28" TextWrapping="NoWrap" Text="000.00" Margin="6"/>
				<Label Content="Exposure" Height="28" VerticalAlignment="Top"/>
				<TextBlock Height="28" TextWrapping="NoWrap" Text="000.00" Margin="6"/>
				<Label Content="Commission" Height="28" VerticalAlignment="Top"/>
				<TextBlock Height="28" TextWrapping="NoWrap" Text="000.00" Margin="6"/>
			</ToolBarPanel>
			<StatusBar DockPanel.Dock="Bottom" Height="23" VerticalAlignment="Bottom" >
				<TextBlock Text="{Binding Path=Status}"></TextBlock>
			</StatusBar>
			<Grid Name="OuterGrid" DockPanel.Dock="Top" >
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="1*"></ColumnDefinition>
					<ColumnDefinition Width="2*"></ColumnDefinition>
				</Grid.ColumnDefinitions>
				<Grid Name="LeftGrid">
					<xctk:BusyIndicator Grid.Row="0" IsBusy="False" IsEnabled="True" Name="_busyIndicator" BusyContent="Loading markets..." >
						<Grid>
							<Grid.RowDefinitions>
								<RowDefinition Height ="24"></RowDefinition>
								<RowDefinition Height ="2*"></RowDefinition>
							</Grid.RowDefinitions>
							<Grid HorizontalAlignment="Stretch">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="80*" />
									<ColumnDefinition Width="80*"/>
									<ColumnDefinition Width="120*"/>
								</Grid.ColumnDefinitions>
								<Button Content="Refresh" Tag="Refresh" Grid.Column="0" Style="{ StaticResource OurButton}" Click="Button_Click" />
								<Button Content="Favourites"  Tag="Favourites" Name="FavouritesButton" Grid.Column="1" Style="{ StaticResource OurButton}" Click="Button_Click" />
								<Button Content="Settings"  Tag="Settings" Grid.Column="2" Style="{ StaticResource OurButton}" Click="Button_Click" />
							</Grid>

							<TreeView Name="EventsTreeView" Grid.Row="1" FontSize="10" DataContext="{Binding ElementName=UI, Path=EventsModel}" ItemsSource="{Binding Children}">
								<TreeView.ItemContainerStyle>
									<Style TargetType="{x:Type TreeViewItem}">
										<Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
										<Setter Property="local:Behaviours.ExpandingBehaviour" Value="{Binding DataContext.ExpandingCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
										<Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
										<Setter Property="local:Behaviours.ExpandingBehaviour" Value="{Binding DataContext.ExpandingCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
									</Style>
								</TreeView.ItemContainerStyle>
								<TreeView.Resources>
									<HierarchicalDataTemplate DataType="{x:Type local:NodeViewModel}" ItemsSource="{Binding Children}">
										<TextBlock Text="{Binding Name}"></TextBlock>
									</HierarchicalDataTemplate>
									<Style TargetType="TreeViewItem">
										<Style.Triggers>
											<Trigger Property="IsExpanded" Value="True"/>
											<Trigger Property="IsSelected" Value="True"/>
										</Style.Triggers>
										<Setter Property="FontWeight" Value="Bold"/>
										<Setter Property="FontStyle" Value="Italic"/>
										<Setter Property="Foreground" Value="Red"/>
										<Setter Property="Background" Value="Green"/>
									</Style>
								</TreeView.Resources>
							</TreeView>
						</Grid>
					</xctk:BusyIndicator>
				</Grid>
				<Border  Grid.Column="1" DockPanel.Dock="Right" BorderBrush="Silver" BorderThickness="1" >
					<Grid Name="RightGrid">
						<Grid.RowDefinitions>
							<RowDefinition Height ="1*"></RowDefinition>
							<RowDefinition Height ="2*"></RowDefinition>
							<RowDefinition Height ="3*"></RowDefinition>
						</Grid.RowDefinitions>
						<Grid Name="MarketGrid" Grid.Row="0">
							<ItemsControl FontFamily="Verdana" FontSize="9" Foreground="#FF5F4D4D" ItemTemplate="{DynamicResource DataTemplate_Runner}" ItemsSource="{Binding LiveRunners}" FontWeight="Medium" >
								<ItemsControl.Template>
									<ControlTemplate>
										<ScrollViewer Name="ScrollViewer" Padding="{TemplateBinding Control.Padding}">
											<ItemsPresenter />
										</ScrollViewer>
									</ControlTemplate>
								</ItemsControl.Template>
							</ItemsControl>
						</Grid>
						<Grid Name="BettingGrid" Grid.Row="1">
							<StackPanel Orientation="Vertical">
								<StackPanel Orientation="Horizontal" Height="24" VerticalAlignment="Top">
									<Label Content="Cut Stakes By %" Width="140"/>
									<Button Content="25" Tag="cut25" Style="{ StaticResource OurButton}" Width="140"/>
									<Button Content="35" Tag="cut35" Style="{ StaticResource OurButton}" Width="140"/>
									<Button Content="50" Tag="cut50" Style="{ StaticResource OurButton}" Width="140"/>
									<Button Content="60" Tag="cut60" Style="{ StaticResource OurButton}" Width="140"/>
									<Button Content="75" Tag="cut75" Style="{ StaticResource OurButton}" Width="140"/>
								</StackPanel>
								<StackPanel Orientation="Horizontal" Height="24" VerticalAlignment="Top">
									<Label Content="Execute Bets" Width="140"/>
									<Button Content="25" Tag="Execute" Width ="120" Style="{ StaticResource OurButton}"/>
								</StackPanel>
								<StackPanel Orientation="Horizontal" Height="24" VerticalAlignment="Top">
									<Label Content="Move Bets Out by Ticks" Width="140"/>
									<Button Content="1" Tag="move1" Style="{ StaticResource OurButton}" Width="80"/>
									<Button Content="2" Tag="move2" Style="{ StaticResource OurButton}" Width="80"/>
									<Button Content="3" Tag="move3" Style="{ StaticResource OurButton}" Width="80"/>
									<Button Content="4" Tag="move4" Style="{ StaticResource OurButton}" Width="80"/>
									<Button Content="5" Tag="move5" Style="{ StaticResource OurButton}" Width="80"/>
								</StackPanel>
							</StackPanel>
						</Grid>
						<Grid Name="BetsManagerGrid"  Grid.Row="2">
							<StackPanel Orientation="Vertical"  VerticalAlignment="Top">
								<StackPanel Orientation="Horizontal" Height="32" VerticalAlignment="Top">
									<Label Content="Bets last updated:" VerticalContentAlignment="Center" Margin="4,0,0,0"/>
									<TextBlock Text="18/10/202 10:27" VerticalAlignment="Center"  Margin="14,0,10,0"/>
									<Button Content="Refresh Bets" Tag="Refresh Bets" Style="{ StaticResource OurButton}" Margin="10,0,10,0"/>
									<Button Content="Cancel All Bets" Tag="Refresh Bets" Style="{ StaticResource OurButton}" Margin="10,0,10,0"/>
									<CheckBox Content="Display Unmatched Only" Tag="Unmatched Only" VerticalContentAlignment="Center" Padding="10,0,10,0"/>
								</StackPanel>

								<DataGrid Name="BetsGrid"  ItemsSource="{Binding AllBets}"  />
							</StackPanel>
						</Grid>
						<GridSplitter Height="5" Grid.Row="1" Grid.ColumnSpan="2" VerticalAlignment="Top" HorizontalAlignment="Stretch" Background="Gray" ResizeDirection="Rows" />
						<GridSplitter Height="5" Grid.Row="2" Grid.ColumnSpan="2" VerticalAlignment="Top" HorizontalAlignment="Stretch" Background="Gray" ResizeDirection="Rows" />
					</Grid>
				</Border>
				<GridSplitter Width="5" Grid.Column="1" Grid.RowSpan="2" HorizontalAlignment="Left" VerticalAlignment="Stretch" Background="Gray" ResizeDirection="Columns" />
			</Grid>
		</DockPanel>
	</Grid>
</Window>
